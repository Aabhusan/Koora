{% load humanize %}
{% load cmt_tag %}

<div class="clearfix"></div>
<hr>
<span class="lead" style="display:block">Comments</span>
{% if comments %}
    <ul class="media-list" style="padding-left:0px">
        {% for comment in comments%}
            <li class="media my-3">
                <a href="#" class="pull-left">
                    <img src="{% if comment.user.has_image %} {{ comment.user.avatar_url }} {% else %}https://robohash.org/{{comment.user.username}}?size=35x35{% endif %}" alt="" class="profile rounded-circle mb-4">
                </a>
                <div class="media-body ml-2">
                    <strong class="lead text-secondary">
                        {{comment.user.username}}
                        <span class="middle-dot"></span>
                        <small>{{ comment.published_at|naturaltime }}</small>
                    </strong>
                    <div class="pull-right dropdown">
                         <button class="btn btn-sm" type="button" id="gedf-drop2" data-toggle="dropdown">
                            <i class="fa fa-ellipsis-h"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right animate slideIn" aria-labelledby="gedf-drop2">
                            {% if article.user == request.user %}
                                    <button class="dropdown-item" style="border:none;color:lightred">
                                        Delete
                                    </button>
                                <div class="dropdown-divider"></div>
                            {% endif %}
                            <a class="dropdown-item" href="#">Report</a>
                        </div>
                    </div>
                    <p>
                        {{comment.content}}
                    </p>
                </div>       
                <a class="btn btn-info" href="#" id="reply"><span class="glyphicon glyphicon-share-alt"></span> Reply</a>
                <a class="btn btn-warning" data-toggle="collapse" href="#reply{{comment.id}}"><span class="glyphicon glyphicon-comment"></span> 2 comments</a>
                <form action = '{% url "comments:detail" model=comment.content_object|get_class slug=comment.slug %}' method = "POST" id="reply{{comment.id}}">
                    {% csrf_token %}
                    <input type="hidden" id="post_id" name="post_id" value="{{comment.post.id}}">
                    <textarea name = "content" class="form-control mt-3" placeholder="Reply to {{comment.user}}" rows="1"></textarea>
                    <br>
                    <button type="submit" class="btn btn-success pull-right">Reply</button>
                </form>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <span>There are no comments in this post yet.</span>
{% endif%}
</div>
